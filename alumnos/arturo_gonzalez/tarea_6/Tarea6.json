{"paragraphs":[{"text":"%md\n### Tarea 6\n#### Arturo González Bencomo 172906","user":"anonymous","dateUpdated":"2018-03-18T16:18:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Tarea 6</h3>\n<h4>Arturo González Bencomo 172906</h4>\n"}]},"apps":[],"jobName":"paragraph_1521388312266_1849829084","id":"20180318-155152_122868442","dateCreated":"2018-03-18T15:51:52+0000","dateStarted":"2018-03-18T16:18:03+0000","dateFinished":"2018-03-18T16:18:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5581"},{"text":"%md \n#### Ejercicio 1\n#### a. ¿Cuántos \"jefes\" hay en la tabla empleados? ¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país? (atributo reportsto, ocupa explode en tu respuesta) b. ¿Quién es el segundo \"mejor\" empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1)) c. ¿Cuál es el delta de tiempo más grande entre una orden y otra?","user":"anonymous","dateUpdated":"2018-03-18T18:22:45+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Ejercicio 1</h4>\n<h4>a. ¿Cuántos &ldquo;jefes&rdquo; hay en la tabla empleados? ¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país? (atributo reportsto, ocupa explode en tu respuesta) b. ¿Quién es el segundo &ldquo;mejor&rdquo; empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1)) c. ¿Cuál es el delta de tiempo más grande entre una orden y otra?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521388446688_356982570","id":"20180318-155406_265041443","dateCreated":"2018-03-18T15:54:06+0000","dateStarted":"2018-03-18T18:22:45+0000","dateFinished":"2018-03-18T18:22:45+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5582"},{"text":"%md\nCargamos los datasets de empleados y ordenes que ya habiamos cargado a s3 en tareas anteriores a dataframes de spark.\n","user":"anonymous","dateUpdated":"2018-03-18T18:23:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Cargamos los datasets de empleados y ordenes que ya habiamos cargado a s3 en tareas anteriores a dataframes de spark.</p>\n"}]},"apps":[],"jobName":"paragraph_1521388838024_-1869021324","id":"20180318-160038_1456156944","dateCreated":"2018-03-18T16:00:38+0000","dateStarted":"2018-03-18T18:23:53+0000","dateFinished":"2018-03-18T18:23:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5583"},{"text":"%pyspark\nempleados=spark.read.csv(\"s3a://al102964-bucket1/tarea5/employees/employees.csv\", header = True, inferSchema =True)\nordenes=spark.read.csv(\"s3a://al102964-bucket1/tarea5/orders/orders.csv\", header = True, inferSchema =True)","user":"anonymous","dateUpdated":"2018-03-18T18:15:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1521388554078_-315773046","id":"20180318-155554_1755686541","dateCreated":"2018-03-18T15:55:54+0000","dateStarted":"2018-03-18T18:15:14+0000","dateFinished":"2018-03-18T18:15:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5584"},{"text":"%md \nObservamos la estructura de los dataframes","user":"anonymous","dateUpdated":"2018-03-18T16:06:59+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Observamos la estructura de los dataframes</p>\n"}]},"apps":[],"jobName":"paragraph_1521389158143_-1432120073","id":"20180318-160558_1625649771","dateCreated":"2018-03-18T16:05:58+0000","dateStarted":"2018-03-18T16:06:59+0000","dateFinished":"2018-03-18T16:06:59+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5585"},{"text":"%pyspark\nempleados.describe().show()\n","user":"anonymous","dateUpdated":"2018-03-18T16:10:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+------------------+--------+---------+--------------------+---------------+--------------------+--------+------+------------------+-------+--------------+------------------+-----+--------------------+------------------+--------------------+\n|summary|        employeeid|lastname|firstname|               title|titleofcourtesy|             address|    city|region|        postalcode|country|     homephone|         extension|photo|               notes|         reportsto|           photopath|\n+-------+------------------+--------+---------+--------------------+---------------+--------------------+--------+------+------------------+-------+--------------+------------------+-----+--------------------+------------------+--------------------+\n|  count|                 9|       9|        9|                   9|              9|                   9|       9|     5|                 9|      9|             9|                 9|    9|                   9|                 8|                   9|\n|   mean|               5.0|    null|     null|                null|           null|                null|    null|  null|           98142.6|   null|          null|            2733.0| null|                null|             3.125|                null|\n| stddev|2.7386127875258306|    null|     null|                null|           null|                null|    null|  null|149.02113944001286|   null|          null|1958.4303663903909| null|                null|1.5526475085202969|                null|\n|    min|                 1|Buchanan|   Andrew|Inside Sales Coor...|            Dr.|     14 Garrett Hill|Kirkland|    WA|             98033|     UK|(206) 555-1189|               428|   \\x|Andrew received h...|                 2|http://accweb/emm...|\n|    max|                 9|  Suyama|   Steven|Vice President; S...|            Ms.|Edgeham Hollow\\nW...|  Tacoma|    WA|           WG2 7LT|    USA| (71) 555-7773|              5467|   \\x|Steven Buchanan g...|                 5|http://accweb/emm...|\n+-------+------------------+--------+---------+--------------------+---------------+--------------------+--------+------+------------------+-------+--------------+------------------+-----+--------------------+------------------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521388713225_-355219937","id":"20180318-155833_910633524","dateCreated":"2018-03-18T15:58:33+0000","dateStarted":"2018-03-18T16:10:31+0000","dateFinished":"2018-03-18T16:10:43+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5586"},{"text":"%pyspark\nordenes.describe().show()","user":"anonymous","dateUpdated":"2018-03-18T16:08:42+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------------+----------+------------------+------------------+------------------+--------------------+--------------------+--------+----------+------------------+-----------+\n|summary|          orderid|customerid|        employeeid|           shipvia|           freight|            shipname|         shipaddress|shipcity|shipregion|    shippostalcode|shipcountry|\n+-------+-----------------+----------+------------------+------------------+------------------+--------------------+--------------------+--------+----------+------------------+-----------+\n|  count|              830|       830|               830|               830|               830|                 830|                 830|     830|       323|               811|        830|\n|   mean|          10662.5|      null| 4.403614457831325|2.0072289156626506| 78.24420481927719|                null|                null|    null|      null|39975.067357512955|       null|\n| stddev|239.7446558319914|      null|2.4996475400823885|0.7796852435554511|116.77929363024192|                null|                null|    null|      null| 36316.43627991753|       null|\n|    min|            10248|     ALFKI|                 1|                 1|              0.02|Alfred's Futterkiste|1 rue Alsace-Lorr...|  Aachen|        AK|            01-012|  Argentina|\n|    max|            11077|     WOLZA|                 9|                 3|           1007.64|       Wolski Zajazd|        Åkergatan 24|   Århus|        WY|           WX3 6FW|  Venezuela|\n+-------+-----------------+----------+------------------+------------------+------------------+--------------------+--------------------+--------+----------+------------------+-----------+\n\n"}]},"apps":[],"jobName":"paragraph_1521389236908_-76710995","id":"20180318-160716_884975877","dateCreated":"2018-03-18T16:07:16+0000","dateStarted":"2018-03-18T16:08:42+0000","dateFinished":"2018-03-18T16:08:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5587"},{"text":"%md \n#### ¿Cuántos “jefes” hay en la tabla empleados?\n\nHacemos la consulta y dejamos a modo de lista para facilitar la consulta más adelante","user":"anonymous","dateUpdated":"2018-03-18T16:43:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>¿Cuántos “jefes” hay en la tabla empleados?</h4>\n<p>Hacemos la consulta y dejamos a modo de lista para facilitar la consulta más adelante</p>\n"}]},"apps":[],"jobName":"paragraph_1521389503392_-1904867034","id":"20180318-161143_412479022","dateCreated":"2018-03-18T16:11:43+0000","dateStarted":"2018-03-18T16:43:28+0000","dateFinished":"2018-03-18T16:43:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5588"},{"text":"%pyspark\nids_jefes = empleados.select(\"reportsto\").filter(empleados.reportsto > 0).distinct().rdd.map(lambda row : row[0]).collect()\nlen(ids_jefes)","user":"anonymous","dateUpdated":"2018-03-18T16:42:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2\n"}]},"apps":[],"jobName":"paragraph_1521389322186_2137072880","id":"20180318-160842_703507805","dateCreated":"2018-03-18T16:08:42+0000","dateStarted":"2018-03-18T16:42:04+0000","dateFinished":"2018-03-18T16:42:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5589"},{"text":"%md\n#### ¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país? (atributo reportsto, ocupa explode en tu respuesta)\n","user":"anonymous","dateUpdated":"2018-03-18T16:43:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país? (atributo reportsto, ocupa explode en tu respuesta)</h4>\n"}]},"apps":[],"jobName":"paragraph_1521389793190_-157708599","id":"20180318-161633_1052421991","dateCreated":"2018-03-18T16:16:33+0000","dateStarted":"2018-03-18T16:43:47+0000","dateFinished":"2018-03-18T16:43:47+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5590"},{"text":"%pyspark\nfrom pyspark.sql.functions import col\n\njefes = empleados.select(\"employeeid\",\"firstname\",\"lastname\",\"title\",\"birthdate\",\"hiredate\",\"city\",\"country\").filter(empleados.employeeid.isin(ids_jefes))\nsubordinados = empleados.select(col(\"firstname\").alias(\"employee_firstname\"),\"reportsto\").filter(empleados.reportsto > 0)\njefes.alias('b').join(subordinados.alias('a'), col('a.reportsto') == col('b.employeeid')).show()\n","user":"anonymous","dateUpdated":"2018-03-18T17:29:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+------------------+---------+\n|employeeid|firstname|lastname|               title|          birthdate|           hiredate|  city|country|employee_firstname|reportsto|\n+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+------------------+---------+\n|         2|   Andrew|  Fuller|Vice President; S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|             Laura|        2|\n|         2|   Andrew|  Fuller|Vice President; S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|            Steven|        2|\n|         2|   Andrew|  Fuller|Vice President; S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|          Margaret|        2|\n|         2|   Andrew|  Fuller|Vice President; S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|             Janet|        2|\n|         2|   Andrew|  Fuller|Vice President; S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|             Nancy|        2|\n|         5|   Steven|Buchanan|       Sales Manager|1955-03-04 00:00:00|1993-10-17 00:00:00|London|     UK|              Anne|        5|\n|         5|   Steven|Buchanan|       Sales Manager|1955-03-04 00:00:00|1993-10-17 00:00:00|London|     UK|            Robert|        5|\n|         5|   Steven|Buchanan|       Sales Manager|1955-03-04 00:00:00|1993-10-17 00:00:00|London|     UK|           Michael|        5|\n+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+------------------+---------+\n\n"}]},"apps":[],"jobName":"paragraph_1521389891607_-295678568","id":"20180318-161811_229231265","dateCreated":"2018-03-18T16:18:11+0000","dateStarted":"2018-03-18T17:29:21+0000","dateFinished":"2018-03-18T17:29:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5591"},{"text":"%md\n#### b. ¿Quién es el segundo \"mejor\" empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1))","user":"anonymous","dateUpdated":"2018-03-18T16:58:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>b. ¿Quién es el segundo &ldquo;mejor&rdquo; empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1))</h4>\n"}]},"apps":[],"jobName":"paragraph_1521390203175_-692928256","id":"20180318-162323_884220706","dateCreated":"2018-03-18T16:23:23+0000","dateStarted":"2018-03-18T16:58:30+0000","dateFinished":"2018-03-18T16:58:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5592"},{"text":"%pyspark\n\nfrom pyspark.sql.functions import lit\n\nempleados_top = ordenes.select(\"employeeid\",\"orderid\").groupBy(ordenes.employeeid).agg({\"orderid\": \"count\"}).orderBy(\"count(orderid)\", ascending=False).limit(2)\nordenes_maximas = empleados_top.select(col(\"count(orderid)\").alias(\"ordenes_maximas\")).limit(1).agg({\"ordenes_maximas\": \"max\"}).collect()[0][0]\nsegundo_mejor = empleados_top.orderBy(\"count(orderid)\").limit(1).withColumn(\"ordenes_maximas\", lit(ordenes_maximas))\nempleados.select(\"employeeid\",\"firstname\",\"lastname\",\"title\",\"hiredate\").alias('e').join(segundo_mejor.alias('sm'),col('e.employeeid') == col('sm.employeeid')).show()\n","user":"anonymous","dateUpdated":"2018-03-18T17:55:08+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+---------+---------+--------------------+-------------------+----------+--------------+---------------+\n|employeeid|firstname| lastname|               title|           hiredate|employeeid|count(orderid)|ordenes_maximas|\n+----------+---------+---------+--------------------+-------------------+----------+--------------+---------------+\n|         3|    Janet|Leverling|Sales Representative|1992-04-01 00:00:00|         3|           127|            156|\n+----------+---------+---------+--------------------+-------------------+----------+--------------+---------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521392288271_1814562633","id":"20180318-165808_1557726687","dateCreated":"2018-03-18T16:58:08+0000","dateStarted":"2018-03-18T17:55:08+0000","dateFinished":"2018-03-18T17:55:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5593"},{"text":"%md\n#### c. ¿Cuál es el delta de tiempo más grande entre una orden y otra?\n","user":"anonymous","dateUpdated":"2018-03-18T17:56:04+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>c. ¿Cuál es el delta de tiempo más grande entre una orden y otra?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521392527070_1207599079","id":"20180318-170207_749865699","dateCreated":"2018-03-18T17:02:07+0000","dateStarted":"2018-03-18T17:56:04+0000","dateFinished":"2018-03-18T17:56:04+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5594"},{"text":"%pyspark\n\nfrom pyspark.sql.window import Window\nfrom pyspark.sql.functions import lag\nfrom pyspark.sql.functions import datediff\n\n\nw = Window().partitionBy().orderBy(col(\"orderid\"))\nordenes_lag = ordenes.select(\"orderid\",\"orderdate\", lag(\"orderdate\").over(w).alias(\"date_laggeada\"))\ntime_diff = ordenes_lag.select(\"orderid\",datediff(ordenes_lag.orderdate,ordenes_lag.date_laggeada).alias(\"diff_tiempo\")).orderBy(\"diff_tiempo\",ascending=False).limit(1).show()\n","user":"anonymous","dateUpdated":"2018-03-18T18:16:43+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-----------+\n|orderid|diff_tiempo|\n+-------+-----------+\n|  10250|          3|\n+-------+-----------+\n\n"}]},"apps":[],"jobName":"paragraph_1521395764956_474062407","id":"20180318-175604_1028021164","dateCreated":"2018-03-18T17:56:04+0000","dateStarted":"2018-03-18T18:16:43+0000","dateFinished":"2018-03-18T18:16:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5595"},{"text":"%md\n#### Ejercicio 2. Con los archivos de vuelos, aeropuertos y aerolíneas que están en el dropbox\n","user":"anonymous","dateUpdated":"2018-03-18T18:17:14+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>Ejercicio 2. Con los archivos de vuelos, aeropuertos y aerolíneas que están en el dropbox</h4>\n"}]},"apps":[],"jobName":"paragraph_1521395959297_-1860919016","id":"20180318-175919_1540948918","dateCreated":"2018-03-18T17:59:19+0000","dateStarted":"2018-03-18T18:17:14+0000","dateFinished":"2018-03-18T18:17:14+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5596"},{"text":"%md \n#### a. ¿Qué aerolíneas (nombres) llegan al aeropuerto \"Honolulu International Airport\"?","user":"anonymous","dateUpdated":"2018-03-18T18:21:10+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>a. ¿Qué aerolíneas (nombres) llegan al aeropuerto &ldquo;Honolulu International Airport&rdquo;?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521397034137_-1977753510","id":"20180318-181714_1853005662","dateCreated":"2018-03-18T18:17:14+0000","dateStarted":"2018-03-18T18:21:10+0000","dateFinished":"2018-03-18T18:21:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5597"},{"text":"%md\nCargamos los datasets de flights, airports y airlines que ya habiamos cargado a s3 en tareas anteriores a dataframes de spark.","user":"anonymous","dateUpdated":"2018-03-18T18:23:44+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>Cargamos los datasets de flights, airports y airlines que ya habiamos cargado a s3 en tareas anteriores a dataframes de spark.</p>\n"}]},"apps":[],"jobName":"paragraph_1521397055872_1153379011","id":"20180318-181735_1522219156","dateCreated":"2018-03-18T18:17:35+0000","dateStarted":"2018-03-18T18:23:44+0000","dateFinished":"2018-03-18T18:23:44+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5598"},{"text":"%pyspark\nflights = spark.read.csv(\"s3://al102964-bucket1/tarea5/flights/flights.csv\", header = True, inferSchema =True)\nairports = spark.read.csv(\"s3://al102964-bucket1/tarea5/airports/airports.csv\", header = True, inferSchema =True)\nairlines = spark.read.csv(\"s3://al102964-bucket1/tarea5/airlines/airlines.csv\", header = True, inferSchema =True)","user":"anonymous","dateUpdated":"2018-03-18T18:21:20+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1521397089462_-178374849","id":"20180318-181809_326703024","dateCreated":"2018-03-18T18:18:09+0000","dateStarted":"2018-03-18T18:21:20+0000","dateFinished":"2018-03-18T18:21:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5599"},{"text":"%pyspark\n\n\nhonolulu_code = airports.filter(airports.AIRPORT == \"Honolulu International Airport\").select(\"IATA_CODE\").collect()[0][0]\nairlines_hnl_code = flights.filter(flights.DESTINATION_AIRPORT == honolulu_code).select(\"AIRLINE\").distinct().rdd.map(lambda row : row[0]).collect()\nairlines.filter(airlines.IATA_CODE.isin(airlines_hnl_code)).select(airlines.AIRLINE).show()\n","user":"anonymous","dateUpdated":"2018-03-18T18:55:45+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+\n|             AIRLINE|\n+--------------------+\n|United Air Lines ...|\n|American Airlines...|\n|     US Airways Inc.|\n|Alaska Airlines Inc.|\n|Delta Air Lines Inc.|\n|Hawaiian Airlines...|\n|      Virgin America|\n+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521397280084_-2017815013","id":"20180318-182120_370025743","dateCreated":"2018-03-18T18:21:20+0000","dateStarted":"2018-03-18T18:55:45+0000","dateFinished":"2018-03-18T18:56:15+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5600"},{"text":"%md\n#### b. ¿En qué horario (hora del día, no importan los minutos) hay salidas del aeropuerto de San Francisco (\"SFO\") a \"Honolulu International Airport\"?","user":"anonymous","dateUpdated":"2018-03-18T18:56:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>b. ¿En qué horario (hora del día, no importan los minutos) hay salidas del aeropuerto de San Francisco (&ldquo;SFO&rdquo;) a &ldquo;Honolulu International Airport&rdquo;?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521397823023_1485492812","id":"20180318-183023_694660217","dateCreated":"2018-03-18T18:30:23+0000","dateStarted":"2018-03-18T18:56:37+0000","dateFinished":"2018-03-18T18:56:37+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5601"},{"text":"%pyspark\n\n\nhonolulu_code = airports.filter(airports.AIRPORT == \"Honolulu International Airport\").select(\"IATA_CODE\").collect()[0][0]\ndeparture_time = flights.filter(flights.DESTINATION_AIRPORT == honolulu_code).filter(flights.ORIGIN_AIRPORT == \"SFO\").select(flights.DEPARTURE_TIME).filter(flights.DEPARTURE_TIME.isNotNull())\nhours_list = departure_time.rdd.map(lambda row : int(row[0]/100)).distinct().collect()\nspark.createDataFrame(hours_list, IntegerType()).orderBy(\"Value\").show()\n","user":"anonymous","dateUpdated":"2018-03-18T20:00:41+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+\n|value|\n+-----+\n|    1|\n|    6|\n|    7|\n|    8|\n|    9|\n|   10|\n|   11|\n|   12|\n|   13|\n|   14|\n|   15|\n|   16|\n|   17|\n|   18|\n|   19|\n|   20|\n|   21|\n|   22|\n|   23|\n+-----+\n\n"}]},"apps":[],"jobName":"paragraph_1521399397726_-1876024391","id":"20180318-185637_1071437665","dateCreated":"2018-03-18T18:56:37+0000","dateStarted":"2018-03-18T20:00:41+0000","dateFinished":"2018-03-18T20:00:49+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5602"},{"text":"%md\n#### c. ¿Qué día de la semana y en qué aerolínea nos conviene viajar a \"Honolulu International Airport\" para tener el menor retraso posible? \n","user":"anonymous","dateUpdated":"2018-03-18T19:30:13+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>c. ¿Qué día de la semana y en qué aerolínea nos conviene viajar a &ldquo;Honolulu International Airport&rdquo; para tener el menor retraso posible?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521399510410_-1695776371","id":"20180318-185830_2066865149","dateCreated":"2018-03-18T18:58:30+0000","dateStarted":"2018-03-18T19:30:13+0000","dateFinished":"2018-03-18T19:30:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5603"},{"text":"%pyspark\n\nday_airline_least_delay = flights.select(\"DEPARTURE_DELAY\",\"DAY_OF_WEEK\",\"DESTINATION_AIRPORT\",\"AIRLINE\").filter(flights.DESTINATION_AIRPORT == honolulu_code).groupBy(\"DAY_OF_WEEK\",\"AIRLINE\").agg({\"DEPARTURE_DELAY\": \"avg\"}).orderBy(\"avg(DEPARTURE_DELAY)\").limit(1)\n\nairlines.alias('a').join(day_airline_least_delay.alias('b'), col('a.IATA_CODE') == col('b.AIRLINE')).show()\n","user":"anonymous","dateUpdated":"2018-03-18T20:41:41+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------------+-----------+-------+--------------------+\n|IATA_CODE|             AIRLINE|DAY_OF_WEEK|AIRLINE|avg(DEPARTURE_DELAY)|\n+---------+--------------------+-----------+-------+--------------------+\n|       AS|Alaska Airlines Inc.|          3|     AS| -1.8235294117647058|\n+---------+--------------------+-----------+-------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521401413220_808682271","id":"20180318-193013_1318090053","dateCreated":"2018-03-18T19:30:13+0000","dateStarted":"2018-03-18T20:40:59+0000","dateFinished":"2018-03-18T20:41:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5604"},{"text":"%md\n#### d. ¿Cuál es el aeropuerto con mayor tráfico de entrada?\n","user":"anonymous","dateUpdated":"2018-03-18T20:42:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>d. ¿Cuál es el aeropuerto con mayor tráfico de entrada?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521403983697_-593866509","id":"20180318-201303_8846022","dateCreated":"2018-03-18T20:13:03+0000","dateStarted":"2018-03-18T20:42:03+0000","dateFinished":"2018-03-18T20:42:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5605"},{"text":"%pyspark\n\ntop_airport = flights.select(\"DESTINATION_AIRPORT\").groupBy(\"DESTINATION_AIRPORT\").agg({\"DESTINATION_AIRPORT\":\"count\"}).orderBy(\"count(DESTINATION_AIRPORT)\",ascending=False).limit(1)\n\nairports.alias('a').join(top_airport.alias('b'), col('a.IATA_CODE') == col('b.DESTINATION_AIRPORT')).show()\n\n","user":"anonymous","dateUpdated":"2018-03-18T20:52:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------------+-------+-----+-------+--------+---------+-------------------+--------------------------+\n|IATA_CODE|             AIRPORT|   CITY|STATE|COUNTRY|LATITUDE|LONGITUDE|DESTINATION_AIRPORT|count(DESTINATION_AIRPORT)|\n+---------+--------------------+-------+-----+-------+--------+---------+-------------------+--------------------------+\n|      ATL|Hartsfield-Jackso...|Atlanta|   GA|    USA|33.64044|-84.42694|                ATL|                    346904|\n+---------+--------------------+-------+-----+-------+--------+---------+-------------------+--------------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521405723190_-2084502529","id":"20180318-204203_1099781145","dateCreated":"2018-03-18T20:42:03+0000","dateStarted":"2018-03-18T20:52:31+0000","dateFinished":"2018-03-18T20:52:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5606"},{"text":"%md\n#### e. ¿Cuál es la aerolínea con mayor retraso de salida por día de la semana?\n","user":"anonymous","dateUpdated":"2018-03-18T20:53:58+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>e. ¿Cuál es la aerolínea con mayor retraso de salida por día de la semana?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521405904391_-1018855344","id":"20180318-204504_754870212","dateCreated":"2018-03-18T20:45:04+0000","dateStarted":"2018-03-18T20:53:58+0000","dateFinished":"2018-03-18T20:53:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5607"},{"text":"%pyspark\n\nfrom pyspark.sql.functions import rank\n\n\nw = Window.partitionBy(\"DAY_OF_WEEK\").orderBy(col(\"avg(DEPARTURE_DELAY)\").desc())\n\nday_of_week_airline = flights.select(\"DAY_OF_WEEK\",col(\"AIRLINE\").alias(\"IATA_CODE\"),\"DEPARTURE_DELAY\").groupBy(\"DAY_OF_WEEK\",\"IATA_CODE\").agg({\"DEPARTURE_DELAY\":\"avg\"}).orderBy(\"avg(DEPARTURE_DELAY)\",ascending=False).withColumn(\"ranking\",rank().over(w)).filter(col(\"ranking\") == 1).alias('a').join(airlines.alias('b'), \"IATA_CODE\").orderBy(\"DAY_OF_WEEK\",ascending=True).show()\n\n","user":"anonymous","dateUpdated":"2018-03-19T07:30:23+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+-----------+--------------------+-------+--------------------+\n|IATA_CODE|DAY_OF_WEEK|avg(DEPARTURE_DELAY)|ranking|             AIRLINE|\n+---------+-----------+--------------------+-------+--------------------+\n|       NK|          1|  18.795626679697044|      1|    Spirit Air Lines|\n|       NK|          2|  15.714659197012137|      1|    Spirit Air Lines|\n|       UA|          3|  14.282200834726739|      1|United Air Lines ...|\n|       UA|          4|   14.88742760925581|      1|United Air Lines ...|\n|       NK|          5|  15.786104837751099|      1|    Spirit Air Lines|\n|       NK|          6|  15.780295269659536|      1|    Spirit Air Lines|\n|       NK|          7|  17.149202320522118|      1|    Spirit Air Lines|\n+---------+-----------+--------------------+-------+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521406438630_1843060740","id":"20180318-205358_619325972","dateCreated":"2018-03-18T20:53:58+0000","dateStarted":"2018-03-19T07:30:23+0000","dateFinished":"2018-03-19T07:30:32+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5608"},{"text":"%md\n#### f. ¿Cuál es la tercer aerolínea con menor retraso de salida los lunes (day of week = 2)","user":"anonymous","dateUpdated":"2018-03-19T07:31:13+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>f. ¿Cuál es la tercer aerolínea con menor retraso de salida los lunes (day of week = 2)</h4>\n"}]},"apps":[],"jobName":"paragraph_1521441360011_-1004661566","id":"20180319-063600_125152180","dateCreated":"2018-03-19T06:36:00+0000","dateStarted":"2018-03-19T07:31:13+0000","dateFinished":"2018-03-19T07:31:13+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5609"},{"text":"%pyspark\n\nw = Window.partitionBy(\"DAY_OF_WEEK\").orderBy(\"avg(DEPARTURE_DELAY)\")\n\nflights.filter(col(\"DAY_OF_WEEK\") == 2).groupBy(\"DAY_OF_WEEK\",\"AIRLINE\").avg(\"DEPARTURE_DELAY\").orderBy(\"avg(DEPARTURE_DELAY)\").withColumn(\"ranking\",rank().over(w)).filter(col(\"ranking\") == 3).alias('a').join(airlines.alias('b'), col('a.AIRLINE') == col('b.IATA_CODE')).show()\n\n","user":"anonymous","dateUpdated":"2018-03-19T07:44:55+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+-------+--------------------+-------+---------+---------------+\n|DAY_OF_WEEK|AIRLINE|avg(DEPARTURE_DELAY)|ranking|IATA_CODE|        AIRLINE|\n+-----------+-------+--------------------+-------+---------+---------------+\n|          2|     US|   6.475248598806726|      3|       US|US Airways Inc.|\n+-----------+-------+--------------------+-------+---------+---------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521444665784_-1620599409","id":"20180319-073105_979414478","dateCreated":"2018-03-19T07:31:05+0000","dateStarted":"2018-03-19T07:44:05+0000","dateFinished":"2018-03-19T07:44:36+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5610"},{"text":"%md\n#### g. ¿Cuál es el aeropuerto origen que llega a la mayor cantidad de aeropuertos destino diferentes?\n","user":"anonymous","dateUpdated":"2018-03-19T07:45:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>g. ¿Cuál es el aeropuerto origen que llega a la mayor cantidad de aeropuertos destino diferentes?</h4>\n"}]},"apps":[],"jobName":"paragraph_1521444717649_-1794647118","id":"20180319-073157_1420290259","dateCreated":"2018-03-19T07:31:57+0000","dateStarted":"2018-03-19T07:45:17+0000","dateFinished":"2018-03-19T07:45:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5611"},{"text":"%pyspark\n\nfrom pyspark.sql.functions import countDistinct\n\n\ndistinct_flights = flights.select(col(\"ORIGIN_AIRPORT\").alias(\"IATA_CODE\"),\"DESTINATION_AIRPORT\").groupBy(\"IATA_CODE\").agg(countDistinct(\"DESTINATION_AIRPORT\")).orderBy(\"count(DISTINCT DESTINATION_AIRPORT)\",ascending=False).limit(1)\n\nairports.alias('a').join(distinct_flights.alias('b'), \"IATA_CODE\").show()\n\n\n\n","user":"anonymous","dateUpdated":"2018-03-19T18:21:28+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521445517632_-309000799","id":"20180319-074517_2123550956","dateCreated":"2018-03-19T07:45:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:5612","dateFinished":"2018-03-19T18:21:39+0000","dateStarted":"2018-03-19T18:21:28+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+--------------------+-------+-----+-------+--------+---------+-----------------------------------+\n|IATA_CODE|             AIRPORT|   CITY|STATE|COUNTRY|LATITUDE|LONGITUDE|count(DISTINCT DESTINATION_AIRPORT)|\n+---------+--------------------+-------+-----+-------+--------+---------+-----------------------------------+\n|      ATL|Hartsfield-Jackso...|Atlanta|   GA|    USA|33.64044|-84.42694|                                169|\n+---------+--------------------+-------+-----+-------+--------+---------+-----------------------------------+\n\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-03-19T17:54:54+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521482094035_-1538253645","id":"20180319-175454_876178891","dateCreated":"2018-03-19T17:54:54+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7687"}],"name":"Tarea6","id":"2DBTVEUPM","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}
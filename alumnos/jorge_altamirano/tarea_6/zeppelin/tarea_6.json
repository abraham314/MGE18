{"paragraphs":[{"text":"%md\n\n# Tarea 6\n\n## 175904 Jorge III Altamirano Astorga \n\n### Ejercicio 1","user":"anonymous","dateUpdated":"2018-03-18T01:12:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Tarea 6</h1>\n<h2>175904 Jorge III Altamirano Astorga</h2>\n<h3>Ejercicio 1</h3>\n"}]},"apps":[],"jobName":"paragraph_1521321587582_537592978","id":"20180317-211947_1657318336","dateCreated":"2018-03-17T21:19:47+0000","dateStarted":"2018-03-18T01:07:27+0000","dateFinished":"2018-03-18T01:07:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:603"},{"text":"%spark.pyspark\nemployees = spark.read.csv(\"\", header = True, inferSchema = True)\norders = spark.read.csv(\"s3a://jorge-altamirano/northwind/orders.csv\", header = True, inferSchema = True)\norderdetails = spark.read.csv(\"s3a://jorge-altamirano/northwind/order_details.csv\", header = True, inferSchema = True)\nprint(\"Employees:\")\nemployees.printSchema()\nprint(\"Orders:\")\norders.printSchema()\nprint(\"Order Details:\")\norderdetails.printSchema()","user":"anonymous","dateUpdated":"2018-03-18T06:53:09+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Employees:\nroot\n |-- employeeid: integer (nullable = true)\n |-- lastname: string (nullable = true)\n |-- firstname: string (nullable = true)\n |-- title: string (nullable = true)\n |-- titleofcourtesy: string (nullable = true)\n |-- birthdate: timestamp (nullable = true)\n |-- hiredate: timestamp (nullable = true)\n |-- address: string (nullable = true)\n |-- city: string (nullable = true)\n |-- region: string (nullable = true)\n |-- postalcode: string (nullable = true)\n |-- country: string (nullable = true)\n |-- homephone: string (nullable = true)\n |-- extension: integer (nullable = true)\n |-- photo: string (nullable = true)\n |-- notes: string (nullable = true)\n |-- reportsto: integer (nullable = true)\n |-- photopath: string (nullable = true)\n\nOrders:\nroot\n |-- orderid: integer (nullable = true)\n |-- customerid: string (nullable = true)\n |-- employeeid: integer (nullable = true)\n |-- orderdate: timestamp (nullable = true)\n |-- requireddate: timestamp (nullable = true)\n |-- shippeddate: timestamp (nullable = true)\n |-- shipvia: integer (nullable = true)\n |-- freight: double (nullable = true)\n |-- shipname: string (nullable = true)\n |-- shipaddress: string (nullable = true)\n |-- shipcity: string (nullable = true)\n |-- shipregion: string (nullable = true)\n |-- shippostalcode: string (nullable = true)\n |-- shipcountry: string (nullable = true)\n\nOrder Details:\nroot\n |-- orderid: integer (nullable = true)\n |-- productid: integer (nullable = true)\n |-- unitprice: double (nullable = true)\n |-- quantity: integer (nullable = true)\n |-- discount: double (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1521322706845_106302020","id":"20180317-213826_1550620482","dateCreated":"2018-03-17T21:38:26+0000","dateStarted":"2018-03-18T05:44:20+0000","dateFinished":"2018-03-18T05:44:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:604"},{"text":"%md\n#### A\n\n¿Cuántos \"jefes\" hay en la tabla empleados? ¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país? (atributo `reportsto`, ocupa `explode` en tu respuesta)\n\n_Son 2 jefes: Andrew Fuller, Steven Buckanan_","user":"anonymous","dateUpdated":"2018-03-18T01:12:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>A</h4>\n<p>¿Cuántos &ldquo;jefes&rdquo; hay en la tabla empleados? ¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país? (atributo <code>reportsto</code>, ocupa <code>explode</code> en tu respuesta)</p>\n<p><em>Son 2 jefes: Andrew Fuller, Steven Buckanan</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521322720259_-633185366","id":"20180317-213840_1432969859","dateCreated":"2018-03-17T21:38:40+0000","dateStarted":"2018-03-18T01:07:33+0000","dateFinished":"2018-03-18T01:07:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:605"},{"text":"%spark.pyspark\n\nreports = employees.select(\"reportsto\").filter(employees.reportsto > 0).distinct()\nprint(\"Reporta a %d jefes.\"%reports.count())\nreports = [int(i.reportsto) for i in reports.collect()]\nq1a = employees.select(\"employeeid\", \"firstname\", \"lastname\", \"title\", \"birthdate\", \"hiredate\", \"city\", \"country\").\\\n    filter(employees.employeeid.isin(reports))\nq1a.write.csv('s3a://jorge-altamirano/tarea_6/q1a')\nq1a.show()","user":"anonymous","dateUpdated":"2018-03-18T07:03:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Reporta a 2 jefes.\n+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+\n|employeeid|firstname|lastname|               title|          birthdate|           hiredate|  city|country|\n+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+\n|         2|   Andrew|  Fuller|Vice President, S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|\n|         5|   Steven|Buchanan|       Sales Manager|1955-03-04 00:00:00|1993-10-17 00:00:00|London|     UK|\n+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+\n\n"}]},"apps":[],"jobName":"paragraph_1521323010234_722314013","id":"20180317-214330_21746142","dateCreated":"2018-03-17T21:43:30+0000","dateStarted":"2018-03-18T07:03:53+0000","dateFinished":"2018-03-18T07:03:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:606"},{"text":"%md\n#### B\n\n¿Quién es el segundo \"mejor\" empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1))\n\n_El segundo mejor lugar con 127 ventas es Janet Leverling que es Representante de Ventas, fue contratada el 1 de Marzo de 1992. El máximo número de ventas es 156, que corresponde al primer lugar en ventas._","user":"anonymous","dateUpdated":"2018-03-18T01:12:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>B</h4>\n<p>¿Quién es el segundo &ldquo;mejor&rdquo; empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1))</p>\n<p><em>El segundo mejor lugar con 127 ventas es Janet Leverling que es Representante de Ventas, fue contratada el 1 de Marzo de 1992. El máximo número de ventas es 156, que corresponde al primer lugar en ventas.</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521327571461_-1262819348","id":"20180317-225931_1994031624","dateCreated":"2018-03-17T22:59:31+0000","dateStarted":"2018-03-18T01:07:40+0000","dateFinished":"2018-03-18T01:07:40+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:607"},{"text":"%spark.pyspark\nfrom pyspark.sql.functions import col\nfrom pyspark.sql import Row\n\nn_order = orders.groupBy(\"employeeid\").count().sort(col(\"count\").desc()).collect()\n#orders.groupBy(\"employeeid\").count().sort(col(\"count\").desc()).show()\nbest = sc.parallelize([Row(employeeid = n_order[1][0], n_orders = n_order[1][1], best_n_orders = n_order[0][1])]).toDF()\n#best.show()\nq1b = employees.filter(employees.employeeid == n_order[1][0]).\\\n    join(best, employees.employeeid == best.employeeid).\\\n    select(\"firstname\", \"lastname\", \"title\", \"hiredate\", \"n_orders\", \"best_n_orders\")\nq1b.write.csv('s3a://jorge-altamirano/tarea_6/q1b')\nq1b.show()","user":"anonymous","dateUpdated":"2018-03-18T06:54:56+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---------+---------+--------------------+-------------------+--------+-------------+\n|firstname| lastname|               title|           hiredate|n_orders|best_n_orders|\n+---------+---------+--------------------+-------------------+--------+-------------+\n|    Janet|Leverling|Sales Representative|1992-04-01 00:00:00|     127|          156|\n+---------+---------+--------------------+-------------------+--------+-------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521325219149_-1244719181","id":"20180317-222019_789667020","dateCreated":"2018-03-17T22:20:19+0000","dateStarted":"2018-03-18T06:54:56+0000","dateFinished":"2018-03-18T06:55:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:608"},{"text":"%md\n\n#### C\n\n¿Cuál es el delta de tiempo más grande entre una orden y otra?\n\n_Son 3 días._\n","user":"anonymous","dateUpdated":"2018-03-18T01:12:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>C</h4>\n<p>¿Cuál es el delta de tiempo más grande entre una orden y otra?</p>\n<p><em>Son 3 días.</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521327768035_1677555984","id":"20180317-230248_1148383018","dateCreated":"2018-03-17T23:02:48+0000","dateStarted":"2018-03-18T01:08:25+0000","dateFinished":"2018-03-18T01:08:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:609"},{"text":"%pyspark\nfrom pyspark.sql.functions import to_timestamp, col, window, datediff\nfrom pyspark.sql.window import Window\n\ndelta = orders.\\\n    select(\"orderid\", \\\n        to_timestamp(\"orderdate\", \"yyyy/MM/dd HH:mm:ss\").alias(\"orderdate\"),\n        lag(\"orderdate\").over(Window().partitionBy().orderBy(col(\"orderid\").asc())).\\\n            alias(\"lag\")).\\\n    select(\"orderid\", \"orderdate\", \"lag\", #se separa porque no reconoce lag\n        datediff(\"orderdate\", \"lag\").alias(\"delta\")).\\\n    orderBy(col(\"delta\").desc())\n\ndelta.limit(5).show()\nq1c = delta.select(delta.delta).limit(1)\nq1c.show()\nq1c.write.csv('s3a://jorge-altamirano/tarea_6/q1c')","user":"anonymous","dateUpdated":"2018-03-18T06:56:58+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+-------------------+-------------------+-----+\n|orderid|          orderdate|                lag|delta|\n+-------+-------------------+-------------------+-----+\n|  10262|1996-07-22 00:00:00|1996-07-19 00:00:00|    3|\n|  10284|1996-08-19 00:00:00|1996-08-16 00:00:00|    3|\n|  10267|1996-07-29 00:00:00|1996-07-26 00:00:00|    3|\n|  10256|1996-07-15 00:00:00|1996-07-12 00:00:00|    3|\n|  10273|1996-08-05 00:00:00|1996-08-02 00:00:00|    3|\n+-------+-------------------+-------------------+-----+\n\n+-----+\n|delta|\n+-----+\n|    3|\n+-----+\n\n"}]},"apps":[],"jobName":"paragraph_1521331477844_218228524","id":"20180318-000437_764722651","dateCreated":"2018-03-18T00:04:37+0000","dateStarted":"2018-03-18T06:56:58+0000","dateFinished":"2018-03-18T06:57:11+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:610"},{"text":"%md\n### Ejercicio 2\n","user":"anonymous","dateUpdated":"2018-03-18T01:17:13+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h3>Ejercicio 2</h3>\n"}]},"apps":[],"jobName":"paragraph_1521335229061_-1169982211","id":"20180318-010709_375486758","dateCreated":"2018-03-18T01:07:09+0000","dateStarted":"2018-03-18T01:17:06+0000","dateFinished":"2018-03-18T01:17:06+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:611"},{"text":"%spark.pyspark\nflights = spark.read.csv(\"s3a://jorge-altamirano/flights/flights.csv\", header = True, inferSchema = True)\nairports = spark.read.csv(\"s3a://jorge-altamirano/flights/airports.csv\", header = True, inferSchema = True)\nairlines = spark.read.csv(\"s3a://jorge-altamirano/flights/airlines.csv\", header = True, inferSchema = True)\nprint(\"Flights:\")\nflights.printSchema()\nprint(\"Airports:\")\nairports.printSchema()\nprint(\"Airlines:\")\nairlines.printSchema()","user":"anonymous","dateUpdated":"2018-03-18T01:26:58+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"Flights:\nroot\n |-- YEAR: integer (nullable = true)\n |-- MONTH: integer (nullable = true)\n |-- DAY: integer (nullable = true)\n |-- DAY_OF_WEEK: integer (nullable = true)\n |-- AIRLINE: string (nullable = true)\n |-- FLIGHT_NUMBER: integer (nullable = true)\n |-- TAIL_NUMBER: string (nullable = true)\n |-- ORIGIN_AIRPORT: string (nullable = true)\n |-- DESTINATION_AIRPORT: string (nullable = true)\n |-- SCHEDULED_DEPARTURE: integer (nullable = true)\n |-- DEPARTURE_TIME: integer (nullable = true)\n |-- DEPARTURE_DELAY: integer (nullable = true)\n |-- TAXI_OUT: integer (nullable = true)\n |-- WHEELS_OFF: integer (nullable = true)\n |-- SCHEDULED_TIME: integer (nullable = true)\n |-- ELAPSED_TIME: integer (nullable = true)\n |-- AIR_TIME: integer (nullable = true)\n |-- DISTANCE: integer (nullable = true)\n |-- WHEELS_ON: integer (nullable = true)\n |-- TAXI_IN: integer (nullable = true)\n |-- SCHEDULED_ARRIVAL: integer (nullable = true)\n |-- ARRIVAL_TIME: integer (nullable = true)\n |-- ARRIVAL_DELAY: integer (nullable = true)\n |-- DIVERTED: integer (nullable = true)\n |-- CANCELLED: integer (nullable = true)\n |-- CANCELLATION_REASON: string (nullable = true)\n |-- AIR_SYSTEM_DELAY: integer (nullable = true)\n |-- SECURITY_DELAY: integer (nullable = true)\n |-- AIRLINE_DELAY: integer (nullable = true)\n |-- LATE_AIRCRAFT_DELAY: integer (nullable = true)\n |-- WEATHER_DELAY: integer (nullable = true)\n\nAirports:\nroot\n |-- IATA_CODE: string (nullable = true)\n |-- AIRPORT: string (nullable = true)\n |-- CITY: string (nullable = true)\n |-- STATE: string (nullable = true)\n |-- COUNTRY: string (nullable = true)\n |-- LATITUDE: double (nullable = true)\n |-- LONGITUDE: double (nullable = true)\n\nAirlines:\nroot\n |-- IATA_CODE: string (nullable = true)\n |-- AIRLINE: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1521335831569_-1108917694","id":"20180318-011711_385555089","dateCreated":"2018-03-18T01:17:11+0000","dateStarted":"2018-03-18T01:26:59+0000","dateFinished":"2018-03-18T01:27:26+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:612"},{"text":"%md\n\n#### A\n\n¿Qué aerolíneas (nombres) llegan al aeropuerto \"Honolulu International Airport\"?\n\n_Las aerolíneas que llegan al aeropuerto de Honolulu HNL son: Alaska, Delta, Virgin America, US Airways, Hawaiian, AA, United._","user":"anonymous","dateUpdated":"2018-03-18T01:47:06+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>A</h4>\n<p>¿Qué aerolíneas (nombres) llegan al aeropuerto &ldquo;Honolulu International Airport&rdquo;?</p>\n<p><em>Las aerolíneas que llegan al aeropuerto de Honolulu HNL son: Alaska, Delta, Virgin America, US Airways, Hawaiian, AA, United.</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521335809131_499302060","id":"20180318-011649_1178123354","dateCreated":"2018-03-18T01:16:49+0000","dateStarted":"2018-03-18T01:47:06+0000","dateFinished":"2018-03-18T01:47:08+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:613"},{"text":"%pyspark\nfrom pyspark.sql.functions import col\n\nq2a = flights.select(\"DESTINATION_AIRPORT\", \"AIRLINE\").\\\n    join(airports, flights.DESTINATION_AIRPORT == airports.IATA_CODE).\\\n    select(col(\"DESTINATION_AIRPORT\").alias(\"iata_airport\"), \n        col(\"AIRPORT\").alias(\"airport\"),\n        col(\"AIRLINE\").alias(\"airlines\")).\\\n    join(airlines, col(\"airlines\") == airlines.IATA_CODE).\\\n    select(col(\"IATA_CODE\").alias(\"iata\"),\n        col(\"AIRLINE\").alias(\"airline\")).\\\n    filter(col(\"airport\") == \"Honolulu International Airport\").\\\n    distinct()\nq2a.show()\nq2a.write.csv('s3a://jorge-altamirano/tarea_6/q2a')","user":"anonymous","dateUpdated":"2018-03-18T06:57:46+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+--------------------+\n|iata|             airline|\n+----+--------------------+\n|  AS|Alaska Airlines Inc.|\n|  DL|Delta Air Lines Inc.|\n|  VX|      Virgin America|\n|  US|     US Airways Inc.|\n|  HA|Hawaiian Airlines...|\n|  AA|American Airlines...|\n|  UA|United Air Lines ...|\n+----+--------------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521331537448_1303528550","id":"20180318-000537_654935873","dateCreated":"2018-03-18T00:05:37+0000","dateStarted":"2018-03-18T06:57:46+0000","dateFinished":"2018-03-18T06:59:41+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:614"},{"text":"%md\n\n#### B\n\n¿En qué horario (hora del día, no importan los minutos) hay salidas del aeropuerto de San Francisco (\"SFO\") a \"Honolulu International Airport\"?\n\n_Salen a las siguientes horas: 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18 y 19. En formato 24 hrs._\n","user":"anonymous","dateUpdated":"2018-03-18T01:12:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>B</h4>\n<p>¿En qué horario (hora del día, no importan los minutos) hay salidas del aeropuerto de San Francisco (&ldquo;SFO&rdquo;) a &ldquo;Honolulu International Airport&rdquo;?</p>\n<p><em>Salen a las siguientes horas: 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18 y 19. En formato 24 hrs.</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521335370994_1712418631","id":"20180318-010930_1677555470","dateCreated":"2018-03-18T01:09:30+0000","dateStarted":"2018-03-18T01:09:55+0000","dateFinished":"2018-03-18T01:09:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:615"},{"text":"%pyspark\nfrom pyspark.sql.functions import floor\n\nq2b = flights.select(col(\"DESTINATION_AIRPORT\").alias(\"destination\"),\n        col(\"ORIGIN_AIRPORT\").alias(\"origin\"),\n        col(\"SCHEDULED_DEPARTURE\").alias(\"departure_time\")).\\\n    join(airports, col(\"origin\") == col(\"IATA_CODE\")).\\\n    select(\"destination\", \"origin\", \"departure_time\",\n        col(\"AIRPORT\").alias(\"origin2\")).\\\n    join(airports, col(\"destination\") == col(\"IATA_CODE\")).\\\n    select(\"departure_time\", \"destination\",  \n        col(\"AIRPORT\").alias(\"destination2\"),\n        \"origin\", \"origin2\").\\\n    filter((col(\"origin\") == \"SFO\") & \\\n        (col(\"destination2\") == \"Honolulu International Airport\")).\\\n    select(\"departure_time\").\\\n    orderBy(\"departure_time\").\\\n    select(floor(col(\"departure_time\") / 100).alias(\"departs\")).\\\n    distinct().\\\n    orderBy(col(\"departs\"))\n\nq2b.show()\nq2b.write.csv('s3a://jorge-altamirano/tarea_6/q2b')\n    ","user":"anonymous","dateUpdated":"2018-03-18T06:59:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521335366400_-1873471766","id":"20180318-010926_1236924169","dateCreated":"2018-03-18T01:09:26+0000","dateStarted":"2018-03-18T06:59:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:616","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------+\n|departs|\n+-------+\n|      6|\n|      7|\n|      8|\n|      9|\n|     10|\n|     11|\n|     12|\n|     13|\n|     14|\n|     15|\n|     16|\n|     17|\n|     18|\n|     19|\n+-------+\n\n"}]},"dateFinished":"2018-03-18T07:00:40+0000"},{"text":"%md\n\n#### C\n\n¿Qué día de la semana y en qué aerolínea nos conviene viajar a \"Honolulu International Airport\" para tener el menor retraso posible?\n\n_Nos conviene viajar en domingo (day of week 1) por Virgin America, el cual no solo no tiene retraso, sino llega usualmente antes._\n","user":"anonymous","dateUpdated":"2018-03-18T01:12:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>C</h4>\n<p>¿Qué día de la semana y en qué aerolínea nos conviene viajar a &ldquo;Honolulu International Airport&rdquo; para tener el menor retraso posible?</p>\n<p><em>Nos conviene viajar en domingo (day of week 1) por Virgin America, el cual no solo no tiene retraso, sino llega usualmente antes.</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521335402084_-1339009571","id":"20180318-011002_538265827","dateCreated":"2018-03-18T01:10:02+0000","dateStarted":"2018-03-18T01:10:18+0000","dateFinished":"2018-03-18T01:10:18+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:617"},{"text":"%pyspark\nfrom pyspark.sql.functions import avg, round\n\nq2c = flights.select(col(\"ARRIVAL_DELAY\").alias(\"delay\"), \n        col(\"DESTINATION_AIRPORT\").alias(\"destination\"),\n        col(\"DAY_OF_WEEK\").alias(\"day\"),\n        col(\"AIRLINE\").alias(\"airline1\")\n    ).\\\n    join(airports, col(\"destination\") == airports.IATA_CODE).\\\n    filter(col(\"airport\") == \"Honolulu International Airport\").\\\n    groupBy(\"day\", \"airline1\").avg(\"delay\").\\\n    select(\"day\", \"airline1\", round(col(\"avg(delay)\"), 2).alias(\"delay\")).\\\n    orderBy(col(\"delay\").asc()).\\\n    join(airlines, col(\"airline1\") == airlines.IATA_CODE).\\\n    select(\"day\", \"airline1\", \"delay\", col(\"airline\").alias(\"airline_name\")).\\\n    limit(1)\n    \nq2c.show()\nq2c.write.csv('s3a://jorge-altamirano/tarea_6/q2c')","user":"anonymous","dateUpdated":"2018-03-18T07:00:44+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521335403349_1280158437","id":"20180318-011003_196181033","dateCreated":"2018-03-18T01:10:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:618","dateFinished":"2018-03-18T07:01:05+0000","dateStarted":"2018-03-18T07:00:44+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+--------+------+--------------+\n|day|airline1| delay|  airline_name|\n+---+--------+------+--------------+\n|  1|      VX|-14.22|Virgin America|\n+---+--------+------+--------------+\n\n"}]}},{"text":"%md\n\n#### D\n\n¿Cuál es el aeropuerto con mayor tráfico de entrada?\n\n_El aeropuerto con más tráfico de entrada es: Hartsfield-Jackson Atlanta (GA, USA). Investigando un poco, esto se debe a que es el Hub de [Delta](https://en.wikipedia.org/wiki/Delta_Air_Lines)_ _(una de las mayores aerolíneas) y de [Sky Team](https://en.wikipedia.org/wiki/SkyTeam) (una de las mayores alianzas y hub de estas)._\n","user":"anonymous","dateUpdated":"2018-03-18T01:12:35+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>D</h4>\n<p>¿Cuál es el aeropuerto con mayor tráfico de entrada?</p>\n<p><em>El aeropuerto con más tráfico de entrada es: Hartsfield-Jackson Atlanta (GA, USA). Investigando un poco, esto se debe a que es el Hub de <a href=\"https://en.wikipedia.org/wiki/Delta_Air_Lines\">Delta</a></em> <em>(una de las mayores aerolíneas) y de <a href=\"https://en.wikipedia.org/wiki/SkyTeam\">Sky Team</a> (una de las mayores alianzas y hub de estas).</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521335427299_546088184","id":"20180318-011027_565485299","dateCreated":"2018-03-18T01:10:27+0000","dateStarted":"2018-03-18T01:10:50+0000","dateFinished":"2018-03-18T01:10:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:619"},{"text":"%pyspark\n\nq2d = flights.select(col(\"DESTINATION_AIRPORT\").alias(\"destination\")).\\\n    groupBy(\"destination\").count().\\\n    orderBy(col(\"count\").desc()).\\\n    limit(1).\\\n    join(airports, col(\"destination\") == airports.IATA_CODE).\\\n    select(\"destination\", \n        col(\"AIRPORT\").alias(\"airport\"), \n        \"count\")\n        \nq2d.show()\nq2d.write.csv('s3a://jorge-altamirano/tarea_6/q2d')","user":"anonymous","dateUpdated":"2018-03-18T07:01:24+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521335450487_758100153","id":"20180318-011050_1111151534","dateCreated":"2018-03-18T01:10:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:620","dateFinished":"2018-03-18T07:01:41+0000","dateStarted":"2018-03-18T07:01:24+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+--------------------+------+\n|destination|             airport| count|\n+-----------+--------------------+------+\n|        ATL|Hartsfield-Jackso...|346904|\n+-----------+--------------------+------+\n\n"}]}},{"text":"%md\n\n#### E\n\n¿Cuál es la aerolínea con mayor retraso de salida por día de la semana?\n\n_* Domingo, Lunes, Miércoles, Jueves, Viernes, Sábado._\n\n_* Martes es Frontier._","user":"anonymous","dateUpdated":"2018-03-18T06:17:02+0000","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false}}},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","tableHide":false,"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>E</h4>\n<p>¿Cuál es la aerolínea con mayor retraso de salida por día de la semana?</p>\n<p><em>* Domingo, Lunes, Miércoles, Jueves, Viernes, Sábado.</em></p>\n<p><em>* Martes es Frontier.</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521335464639_-2066326199","id":"20180318-011104_1240583794","dateCreated":"2018-03-18T01:11:04+0000","dateStarted":"2018-03-18T06:17:02+0000","dateFinished":"2018-03-18T06:17:02+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:621"},{"text":"%pyspark\nfrom pyspark.sql.functions import window, avg\nfrom pyspark.sql.window import Window\n\nq2e = flights.select(\\\n        col(\"DAY_OF_WEEK\").alias(\"day\"),\n        col(\"ARRIVAL_DELAY\").alias(\"delay\"),\n        col(\"AIRLINE\").alias(\"iata\")).\\\n    groupBy(\"day\", \"iata\").avg(\"delay\").\\\n    select(\"*\", col(\"avg(delay)\").alias(\"delay2\")).\\\n    select(\\\n        \"*\",\n        rank().over(Window().partitionBy(\"day\").orderBy(col(\"delay2\").desc())).alias(\"rank\")\n    ).\\\n    filter(col(\"rank\") == 1).\\\n    orderBy(\"day\").\\\n    join(airlines, col(\"iata\") == airlines.IATA_CODE).\\\n    select(\"day\", \"iata\", col(\"AIRLINE\").alias(\"airline\"))\n\nq2e.show()\nq2e.write.csv('s3a://jorge-altamirano/tarea_6/q2e')\n","user":"anonymous","dateUpdated":"2018-03-18T07:01:48+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python","tableHide":false,"editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521335488380_-904522438","id":"20180318-011128_1787314590","dateCreated":"2018-03-18T01:11:28+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:622","dateFinished":"2018-03-18T07:02:13+0000","dateStarted":"2018-03-18T07:01:48+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+---+----+--------------------+\n|day|iata|             airline|\n+---+----+--------------------+\n|  1|  NK|    Spirit Air Lines|\n|  2|  NK|    Spirit Air Lines|\n|  3|  F9|Frontier Airlines...|\n|  4|  NK|    Spirit Air Lines|\n|  5|  NK|    Spirit Air Lines|\n|  6|  NK|    Spirit Air Lines|\n|  7|  NK|    Spirit Air Lines|\n+---+----+--------------------+\n\n"}]}},{"text":"%md\n\n#### F\n\n¿Cuál es la tercer aerolínea con menor retraso de salida los lunes (day of week = 2)?\n\n_Es US Airway tercera aerolínea con menor atraso los lunes._","user":"anonymous","dateUpdated":"2018-03-18T06:33:12+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","tableHide":false,"editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>F</h4>\n<p>¿Cuál es la tercer aerolínea con menor retraso de salida los lunes (day of week = 2)?</p>\n<p><em>Es US Airway tercera aerolínea con menor atraso los lunes.</em></p>\n"}]},"apps":[],"jobName":"paragraph_1521335545359_1625109635","id":"20180318-011225_166449163","dateCreated":"2018-03-18T01:12:25+0000","dateStarted":"2018-03-18T06:33:12+0000","dateFinished":"2018-03-18T06:33:12+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:623"},{"text":"%pyspark\nfrom pyspark.sql.functions import avg, round\nfrom pyspark.sql.window import Window\n\nq2f = flights.select(flights.DAY_OF_WEEK.alias(\"day\"),\n        flights.AIRLINE.alias(\"iata\"),\n        flights.DEPARTURE_DELAY.alias(\"delay\")).\\\n    filter(col(\"day\") == 2).\\\n    groupBy(\"iata\").avg(\"delay\").\\\n    orderBy(col(\"avg(delay)\").asc()).\\\n    limit(3).\\\n    select(\\\n        \"*\",\n        rank().over(Window().partitionBy().orderBy(col(\"avg(delay)\").asc())).alias(\"rank\")\n    ).\\\n    join(airlines, col(\"iata\") == airlines.IATA_CODE).\\\n    filter(col(\"rank\") == 3).\\\n    select(\"iata\", col(\"AIRLINE\").alias(\"airline\"))\n    \nq2f.show()\nq2f.write.csv('s3a://jorge-altamirano/tarea_6/q2f')","user":"anonymous","dateUpdated":"2018-03-18T07:02:22+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521335568848_1483937437","id":"20180318-011248_454308886","dateCreated":"2018-03-18T01:12:48+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:624","dateFinished":"2018-03-18T07:02:39+0000","dateStarted":"2018-03-18T07:02:22+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+---------------+\n|iata|        airline|\n+----+---------------+\n|  US|US Airways Inc.|\n+----+---------------+\n\n"}]}},{"text":"%md\n\n#### G\n\n¿Cuál es el aeropuerto origen que llega a la mayor cantidad de aeropuertos destino diferentes?\n\n_El aeropuerto con más destinos diferentes es Hartsfield-Jackson, como se mencione en el Ejercicio 2D_.","user":"anonymous","dateUpdated":"2018-03-18T01:15:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h4>G</h4>\n<p>¿Cuál es el aeropuerto origen que llega a la mayor cantidad de aeropuertos destino diferentes?</p>\n<p><em>El aeropuerto con más destinos diferentes es Hartsfield-Jackson, como se mencione en el Ejercicio 2D</em>.</p>\n"}]},"apps":[],"jobName":"paragraph_1521335577076_-1681776513","id":"20180318-011257_1073975277","dateCreated":"2018-03-18T01:12:57+0000","dateStarted":"2018-03-18T01:15:33+0000","dateFinished":"2018-03-18T01:15:33+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:625"},{"text":"%pyspark\n\nq2g = flights.select(\n        flights.ORIGIN_AIRPORT.alias(\"origin\"),\n        flights.DESTINATION_AIRPORT.alias(\"destination\")).\\\n    #groupBy(\"origin\", \"destination\").count().alias(\"origin_count\").\\\n    groupBy(\"destination\").count().\\\n    orderBy(col(\"count\").desc()).\\\n    limit(1).\\\n    join(airports, col(\"destination\") == airports.IATA_CODE).\\\n    select(\"destination\", \n        col(\"AIRPORT\").alias(\"airport\"))\nq2g.show()\nq2g.write.csv('s3a://jorge-altamirano/tarea_6/q2g')","user":"anonymous","dateUpdated":"2018-03-18T07:03:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521335590524_295463409","id":"20180318-011310_410117857","dateCreated":"2018-03-18T01:13:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:626","dateFinished":"2018-03-18T07:03:47+0000","dateStarted":"2018-03-18T07:03:31+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+--------------------+\n|destination|             airport|\n+-----------+--------------------+\n|        ATL|Hartsfield-Jackso...|\n+-----------+--------------------+\n\n"}]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2018-03-18T06:34:38+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521354878287_-2020306136","id":"20180318-063438_1565109370","dateCreated":"2018-03-18T06:34:38+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:7689"}],"name":"tarea_6","id":"2DB1D9QFF","angularObjects":{"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}
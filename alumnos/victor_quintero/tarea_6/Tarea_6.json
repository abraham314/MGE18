{"paragraphs":[{"title":"","text":"%md \n# Tarea 6\n\n### Victor Quintero Mármol González 175897","user":"anonymous","dateUpdated":"2018-03-19T23:56:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","title":false,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<h1>Tarea 6</h1>\n<h3>Victor Quintero Mármol González 175897</h3>\n"}]},"apps":[],"jobName":"paragraph_1521502599915_-1943793923","id":"20180319-233639_1862273365","dateCreated":"2018-03-19T23:36:39+0000","dateStarted":"2018-03-19T23:56:53+0000","dateFinished":"2018-03-19T23:56:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:1915"},{"text":"%pyspark\n\n#Cargamos las bases de datos:\nemployees=spark.read.csv(\"s3a://vq-mcd2018/tarea_6/Datos/northwind/employees/employees.csv\", header = True, inferSchema =True)\norders=spark.read.csv(\"s3a://vq-mcd2018/tarea_6/Datos/northwind/orders/orders.csv\", header = True, inferSchema =True)\n\nairlines=spark.read.csv(\"s3a://vq-mcd2018/tarea_6/Datos/flights/airlines/airlines.csv\", header = True, inferSchema =True)\nairports=spark.read.csv(\"s3a://vq-mcd2018/tarea_6/Datos/flights/airports/airports.csv\", header = True, inferSchema =True)\nflights=spark.read.csv(\"s3a://vq-mcd2018/tarea_6/Datos/flights/flights/flights.csv\", header = True, inferSchema =True)\n","user":"anonymous","dateUpdated":"2018-03-20T00:13:32+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1521504444601_857813462","id":"20180320-000724_1261954940","dateCreated":"2018-03-20T00:07:24+0000","dateStarted":"2018-03-20T00:13:32+0000","dateFinished":"2018-03-20T00:14:09+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1916"},{"text":"%pyspark\n#importamos funciones útiles\nfrom pyspark.sql.functions import *\nfrom pyspark.sql.window import Window","user":"anonymous","dateUpdated":"2018-03-20T07:11:03+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1521505059701_131820171","id":"20180320-001739_2054602656","dateCreated":"2018-03-20T00:17:39+0000","dateStarted":"2018-03-20T07:11:03+0000","dateFinished":"2018-03-20T07:11:03+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1917"},{"title":"Ejercicio 1","text":"%md\na. ¿Cuántos \"jefes\" hay en la tabla empleados? ¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país? \n","user":"anonymous","dateUpdated":"2018-03-20T00:12:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","title":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>a. ¿Cuántos &ldquo;jefes&rdquo; hay en la tabla empleados? ¿Cuáles son estos jefes: número de empleado, nombre, apellido, título, fecha de nacimiento, fecha en que iniciaron en la empresa, ciudad y país?</p>\n"}]},"apps":[],"jobName":"paragraph_1521502601472_1416248870","id":"20180319-233641_1521429109","dateCreated":"2018-03-19T23:36:41+0000","dateStarted":"2018-03-20T00:12:50+0000","dateFinished":"2018-03-20T00:12:50+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1918"},{"text":"%pyspark\n\n#Primero vemos cuantos jefes distintos hay en la tabla:\nnum_jefes = employees.select(\"reportsto\").distinct().filter(employees.reportsto > 0)\nnum_jefes.count()\n","user":"anonymous","dateUpdated":"2018-03-20T01:27:12+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"2\n"}]},"apps":[],"jobName":"paragraph_1521502601219_1318137900","id":"20180319-233641_1032917073","dateCreated":"2018-03-19T23:36:41+0000","dateStarted":"2018-03-20T00:56:34+0000","dateFinished":"2018-03-20T00:56:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1919"},{"text":"%pyspark\n\n#Ahora vemos cuales son esos jefes y ponemos los datos solicitados usando la función explode:\n\njefes = employees.groupby(col(\"reportsto\").alias(\"id_jefe\")).agg(collect_set(\"firstname\").alias(\"subordinados\")).filter(employees.reportsto > 0).orderBy(\"reportsto\")\n    \njefes = jefes.join(employees, employees.employeeid == jefes.id_jefe) \\\n    .select( \"employeeid\", \n        \"firstname\", \n        \"lastname\", \n        \"title\", \n        \"birthdate\", \n        \"hiredate\", \n        \"city\", \n        \"country\",\n        explode(\"subordinados\").alias(\"subordinados\"))\n          \n\njefes.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej1a.csv\", header = True)       \njefes.show()\n","user":"anonymous","dateUpdated":"2018-03-20T07:19:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+------------+\n|employeeid|firstname|lastname|               title|          birthdate|           hiredate|  city|country|subordinados|\n+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+------------+\n|         2|   Andrew|  Fuller|Vice President, S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|       Janet|\n|         2|   Andrew|  Fuller|Vice President, S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|       Laura|\n|         2|   Andrew|  Fuller|Vice President, S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|       Nancy|\n|         2|   Andrew|  Fuller|Vice President, S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|    Margaret|\n|         2|   Andrew|  Fuller|Vice President, S...|1952-02-19 00:00:00|1992-08-14 00:00:00|Tacoma|    USA|      Steven|\n|         5|   Steven|Buchanan|       Sales Manager|1955-03-04 00:00:00|1993-10-17 00:00:00|London|     UK|      Robert|\n|         5|   Steven|Buchanan|       Sales Manager|1955-03-04 00:00:00|1993-10-17 00:00:00|London|     UK|        Anne|\n|         5|   Steven|Buchanan|       Sales Manager|1955-03-04 00:00:00|1993-10-17 00:00:00|London|     UK|     Michael|\n+----------+---------+--------+--------------------+-------------------+-------------------+------+-------+------------+\n\n"}]},"apps":[],"jobName":"paragraph_1521502600861_1997973882","id":"20180319-233640_239923869","dateCreated":"2018-03-19T23:36:40+0000","dateStarted":"2018-03-20T07:19:31+0000","dateFinished":"2018-03-20T07:19:35+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1920"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","tableHide":false,"editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521503638292_1378986758","id":"20180319-235358_374831289","dateCreated":"2018-03-19T23:53:58+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1921","text":"%md\nb. ¿Quién es el segundo \"mejor\" empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1))","dateUpdated":"2018-03-20T01:36:12+0000","dateFinished":"2018-03-20T01:35:53+0000","dateStarted":"2018-03-20T01:35:53+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>b. ¿Quién es el segundo &ldquo;mejor&rdquo; empleado que más órdenes ha generado? (nombre, apellido, título, cuándo entró a la compañía, número de órdenes generadas, número de órdenes generadas por el mejor empleado (número 1))</p>\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521505159952_-428604090","id":"20180320-001919_1037525105","dateCreated":"2018-03-20T00:19:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:1922","text":"%pyspark\n\nnum_ordenes = orders.groupBy(\"employeeid\").count().orderBy(\"count\", ascending=False)\n\nsegundo = num_ordenes.select(\"*\", lead(\"count\").over(Window.orderBy(\"count\")).alias(\"ordenes_primero\")) \\\n    .orderBy(\"count\", ascending=False).limit(2) \\\n    .orderBy(\"count\", ascending=True).limit(1) \\\n    .join(employees, \"employeeid\") \\\n    .select(\"employeeid\", \n            \"firstname\", \n            \"lastname\", \n            \"title\",            \n            \"hiredate\", \n            \"count\",\n            \"ordenes_primero\")\n            \nsegundo.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej1b.csv\", header = True)   \n\nsegundo.show()\n","dateUpdated":"2018-03-20T07:19:44+0000","dateFinished":"2018-03-20T07:19:49+0000","dateStarted":"2018-03-20T07:19:44+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------+---------+---------+--------------------+-------------------+-----+---------------+\n|employeeid|firstname| lastname|               title|           hiredate|count|ordenes_primero|\n+----------+---------+---------+--------------------+-------------------+-----+---------------+\n|         3|    Janet|Leverling|Sales Representative|1992-04-01 00:00:00|  127|            156|\n+----------+---------+---------+--------------------+-------------------+-----+---------------+\n\n"}]}},{"text":"%md\nc. ¿Cuál es el delta de tiempo más grande entre una orden y otra?\n","user":"anonymous","dateUpdated":"2018-03-20T02:21:58+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521510987773_-1356580393","id":"20180320-015627_1246478163","dateCreated":"2018-03-20T01:56:27+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3741","dateFinished":"2018-03-20T02:21:56+0000","dateStarted":"2018-03-20T02:21:56+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>c. ¿Cuál es el delta de tiempo más grande entre una orden y otra?</p>\n"}]}},{"text":"%pyspark\n\ndelta = orders.select(\"*\", lag(\"orderdate\").over(Window.orderBy(\"orderdate\")).alias(\"prev_orderdate\")) \\\n    .withColumn(\"delta\", datediff(\"orderdate\", \"prev_orderdate\")) \\\n    .orderBy(\"delta\", ascending=False).select(\"delta\") \\\n    .limit(1)\n\ndelta.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej1c.csv\", header = True)  \n\ndelta.show()\n","user":"anonymous","dateUpdated":"2018-03-20T07:19:52+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521510536172_-380164305","id":"20180320-014856_426214414","dateCreated":"2018-03-20T01:48:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3562","dateFinished":"2018-03-20T07:19:56+0000","dateStarted":"2018-03-20T07:19:52+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----+\n|delta|\n+-----+\n|    3|\n+-----+\n\n"}]}},{"text":"%md\na. ¿Qué aerolíneas (nombres) llegan al aeropuerto \"Honolulu International Airport\"?\n    ","user":"anonymous","dateUpdated":"2018-03-20T02:52:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","title":true,"editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521513187203_-732606930","id":"20180320-023307_1572666530","dateCreated":"2018-03-20T02:33:07+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4396","dateFinished":"2018-03-20T02:52:50+0000","dateStarted":"2018-03-20T02:52:50+0000","title":"Ejercicio 2.","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>a. ¿Qué aerolíneas (nombres) llegan al aeropuerto &ldquo;Honolulu International Airport&rdquo;?</p>\n"}]}},{"text":"%pyspark\nHonolulu = flights.select(col(\"airline\").alias(\"iata_airline\"),\"destination_airport\").join(airlines, airlines[\"iata_code\"] == col(\"iata_airline\")) \\\n    .join(airports, flights[\"destination_airport\"] == airports[\"iata_code\"]) \\\n    .filter(col(\"AIRPORT\") == \"Honolulu International Airport\").select(\"iata_airline\",\"AIRLINE\").distinct()\n\nHonolulu.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej2a.csv\", header = True) \n\nHonolulu.show()\n    ","user":"anonymous","dateUpdated":"2018-03-20T07:20:00+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521514375880_67215990","id":"20180320-025255_63003724","dateCreated":"2018-03-20T02:52:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5320","dateFinished":"2018-03-20T07:20:26+0000","dateStarted":"2018-03-20T07:20:00+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------+--------------------+\n|iata_airline|             AIRLINE|\n+------------+--------------------+\n|          AS|Alaska Airlines Inc.|\n|          DL|Delta Air Lines Inc.|\n|          VX|      Virgin America|\n|          US|     US Airways Inc.|\n|          HA|Hawaiian Airlines...|\n|          AA|American Airlines...|\n|          UA|United Air Lines ...|\n+------------+--------------------+\n\n"}]}},{"text":"%md\nb. ¿En qué horario (hora del día, no importan los minutos) hay salidas del aeropuerto de San Francisco (\"SFO\") a \"Honolulu International Airport\"?","user":"anonymous","dateUpdated":"2018-03-20T03:46:22+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521510535832_-434029151","id":"20180320-014855_1374014760","dateCreated":"2018-03-20T01:48:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3506","dateFinished":"2018-03-20T03:46:22+0000","dateStarted":"2018-03-20T03:46:22+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>b. ¿En qué horario (hora del día, no importan los minutos) hay salidas del aeropuerto de San Francisco (&ldquo;SFO&rdquo;) a &ldquo;Honolulu International Airport&rdquo;?</p>\n"}]}},{"text":"%pyspark\n\ncodigo_iata = airports.select(\"iata_code\").filter(col(\"AIRPORT\")==\"Honolulu International Airport\").first()[0]\n\nHoras = flights.filter((col(\"destination_airport\") == codigo_iata) & (col(\"origin_airport\") == \"SFO\") & (col(\"SCHEDULED_DEPARTURE\").isNotNull())) \\\n    .withColumn(\"Hora\", when(flights[\"SCHEDULED_DEPARTURE\"] > 100, floor((flights[\"SCHEDULED_DEPARTURE\"])/100)).otherwise(0))\\\n    .select(\"Hora\") \\\n    .distinct() \\\n    .orderBy(\"Hora\")\n\nHoras.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej2b.csv\", header = True) \nHoras.show()\n","user":"anonymous","dateUpdated":"2018-03-20T07:20:50+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521510535406_-280899089","id":"20180320-014855_369366281","dateCreated":"2018-03-20T01:48:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3450","dateFinished":"2018-03-20T07:21:08+0000","dateStarted":"2018-03-20T07:20:50+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----+\n|Hora|\n+----+\n|   6|\n|   7|\n|   8|\n|   9|\n|  10|\n|  11|\n|  12|\n|  13|\n|  14|\n|  15|\n|  16|\n|  17|\n|  18|\n|  19|\n+----+\n\n"}]}},{"text":"%md\nc. ¿Qué día de la semana y en qué aerolínea nos conviene viajar a \"Honolulu International Airport\" para tener el menor retraso posible? ","user":"anonymous","dateUpdated":"2018-03-20T05:00:52+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521514312697_1502421333","id":"20180320-025152_1278032063","dateCreated":"2018-03-20T02:51:52+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5233","dateFinished":"2018-03-20T05:00:50+0000","dateStarted":"2018-03-20T05:00:50+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>c. ¿Qué día de la semana y en qué aerolínea nos conviene viajar a &ldquo;Honolulu International Airport&rdquo; para tener el menor retraso posible?</p>\n"}]}},{"text":"%pyspark\n\ncodigo_iata = airports.select(\"iata_code\").filter(col(\"AIRPORT\")==\"Honolulu International Airport\").first()[0]\n\ndia_semana = flights.filter((col(\"destination_airport\") == codigo_iata) & (col(\"departure_delay\") > 0) & (col(\"departure_delay\").isNotNull())) \\\n    .select(\"day_of_week\", col(\"airline\").alias(\"iata_airline\"), \"departure_delay\") \\\n    .groupBy(\"day_of_week\", \"iata_airline\").avg(\"departure_delay\") \\\n    .orderBy(\"avg(departure_delay)\", ascending= True).limit(1) \\\n    .join(airlines, airlines[\"iata_code\"] == col(\"iata_airline\")) \\\n    .select(\"day_of_week\",\"iata_airline\",\"airline\", col(\"avg(departure_delay)\").alias(\"retraso_promedio\"))\n    \ndia_semana.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej2c.csv\", header = True) \ndia_semana.show() ","user":"anonymous","dateUpdated":"2018-03-20T07:22:17+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521514311642_333938923","id":"20180320-025151_14510780","dateCreated":"2018-03-20T02:51:51+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5177","dateFinished":"2018-03-20T07:22:53+0000","dateStarted":"2018-03-20T07:22:17+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------------+--------------+----------------+\n|day_of_week|iata_airline|       airline|retraso_promedio|\n+-----------+------------+--------------+----------------+\n|          1|          VX|Virgin America|           3.875|\n+-----------+------------+--------------+----------------+\n\n"}]}},{"text":"%md\nd. ¿Cuál es el aeropuerto con mayor tráfico de entrada?","user":"anonymous","dateUpdated":"2018-03-20T05:36:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521522630850_-1396988444","id":"20180320-051030_1200609819","dateCreated":"2018-03-20T05:10:30+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8299","dateFinished":"2018-03-20T05:36:21+0000","dateStarted":"2018-03-20T05:36:21+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>d. ¿Cuál es el aeropuerto con mayor tráfico de entrada?</p>\n"}]}},{"text":"%pyspark\n\nmas_entradas = flights.select(\"destination_airport\").groupBy(\"destination_airport\").count() \\\n    .join(airports, flights[\"destination_airport\"] == airports[\"iata_code\"]) \\\n    .orderBy(\"count\", ascending=False).select(\"destination_airport\",\"AIRPORT\",col(\"count\").alias(\"entradas\")).limit(1)\n    \n\nmas_entradas.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej2d.csv\", header = True)\n\nmas_entradas.show()","user":"anonymous","dateUpdated":"2018-03-20T07:23:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521522629034_-68465817","id":"20180320-051029_1965406346","dateCreated":"2018-03-20T05:10:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8243","dateFinished":"2018-03-20T07:23:48+0000","dateStarted":"2018-03-20T07:23:29+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------+--------------------+--------+\n|destination_airport|             AIRPORT|entradas|\n+-------------------+--------------------+--------+\n|                ATL|Hartsfield-Jackso...|  346904|\n+-------------------+--------------------+--------+\n\n"}]}},{"text":"%md\ne. ¿Cuál es la aerolínea con mayor retraso de salida por día de la semana?","user":"anonymous","dateUpdated":"2018-03-20T05:49:37+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521522622115_-1898346910","id":"20180320-051022_745799893","dateCreated":"2018-03-20T05:10:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8187","dateFinished":"2018-03-20T05:49:34+0000","dateStarted":"2018-03-20T05:49:34+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>e. ¿Cuál es la aerolínea con mayor retraso de salida por día de la semana?</p>\n"}]}},{"text":"%pyspark\n\nretraso_aerolineas = flights.filter((col(\"departure_delay\") > 0) & (col(\"departure_delay\").isNotNull())) \\\n    .select(col(\"airline\").alias(\"iata_airline\"),\"departure_delay\", \"day_of_week\") \\\n    .groupBy(\"day_of_week\", \"iata_airline\").agg(round(avg(\"departure_delay\"),2).alias(\"retraso_prom\")) \\\n    .join(airlines, airlines[\"iata_code\"] == col(\"iata_airline\")).select(\"day_of_week\",\"iata_airline\",\"retraso_prom\", \"airline\")\n    \n    \nretraso_dia = retraso_aerolineas.select(col(\"day_of_week\").alias(\"dia_semana\"),\"iata_airline\",\"retraso_prom\", \"airline\").groupBy(\"dia_semana\").agg(max(\"retraso_prom\").alias(\"max_retraso\")) \\\n    .join(retraso_aerolineas, col(\"retraso_prom\")==col(\"max_retraso\")) \\\n    .select(\"day_of_week\",\"airline\", \"max_retraso\") \\\n    .orderBy(\"day_of_week\", ascending=True)\n\nretraso_dia.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej2e.csv\", header = True)\n\nretraso_dia.show()","user":"anonymous","dateUpdated":"2018-03-20T07:24:10+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521522619475_1750242234","id":"20180320-051019_1645975809","dateCreated":"2018-03-20T05:10:19+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8131","dateFinished":"2018-03-20T07:24:33+0000","dateStarted":"2018-03-20T07:24:10+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+--------------------+-----------+\n|day_of_week|             airline|max_retraso|\n+-----------+--------------------+-----------+\n|          1|Frontier Airlines...|      50.22|\n|          2|Frontier Airlines...|      47.32|\n|          3|Frontier Airlines...|      43.85|\n|          4|Atlantic Southeas...|      41.68|\n|          5|Frontier Airlines...|      41.88|\n|          6|Frontier Airlines...|      44.57|\n|          7|Frontier Airlines...|      44.16|\n+-----------+--------------------+-----------+\n\n"}]}},{"text":"%md\nf. ¿Cuál es la tercer aerolínea con menor retraso de salida los lunes (day of week = 2)?","user":"anonymous","dateUpdated":"2018-03-20T06:22:07+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521526916398_1825323741","id":"20180320-062156_1739230808","dateCreated":"2018-03-20T06:21:56+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9555","dateFinished":"2018-03-20T06:22:04+0000","dateStarted":"2018-03-20T06:22:04+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>f. ¿Cuál es la tercer aerolínea con menor retraso de salida los lunes (day of week = 2)?</p>\n"}]}},{"text":"%pyspark\n\nretraso_aerolineas = flights.filter( (col(\"day_of_week\") == 2) & (col(\"departure_delay\") > 0) & (col(\"departure_delay\").isNotNull())) \\\n    .select(col(\"airline\").alias(\"iata_airline\"),\"departure_delay\") \\\n    .groupBy(\"iata_airline\").agg(round(avg(\"departure_delay\"),2).alias(\"retraso_prom\")) \\\n    .join(airlines, airlines[\"iata_code\"] == col(\"iata_airline\")).select(\"iata_airline\",\"retraso_prom\", \"airline\") \\\n    .orderBy(\"retraso_prom\", ascending=True) \\\n    .withColumn(\"rank\", rank().over(Window.orderBy(\"retraso_prom\"))) \\\n    .filter(col(\"rank\") == 3)\n\nretraso_aerolineas.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej2f.csv\", header = True)\n  \nretraso_aerolineas.show()","user":"anonymous","dateUpdated":"2018-03-20T07:25:19+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521526914378_-1259623588","id":"20180320-062154_1912473664","dateCreated":"2018-03-20T06:21:54+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:9499","dateFinished":"2018-03-20T07:25:36+0000","dateStarted":"2018-03-20T07:25:19+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------+------------+--------------------+----+\n|iata_airline|retraso_prom|             airline|rank|\n+------------+------------+--------------------+----+\n|          WN|       27.68|Southwest Airline...|   3|\n+------------+------------+--------------------+----+\n\n"}]}},{"text":"%md\ng. ¿Cuál es el aeropuerto origen que llega a la mayor cantidad de aeropuertos destino diferentes?","user":"anonymous","dateUpdated":"2018-03-20T06:41:27+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"text","editOnDblClick":false},"editorMode":"ace/mode/text","editorHide":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521522617789_1116945545","id":"20180320-051017_595633730","dateCreated":"2018-03-20T05:10:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:8075","dateFinished":"2018-03-20T06:41:25+0000","dateStarted":"2018-03-20T06:41:25+0000","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<p>g. ¿Cuál es el aeropuerto origen que llega a la mayor cantidad de aeropuertos destino diferentes?</p>\n"}]}},{"text":"%pyspark\n\nmas_destinos = flights.select(\"origin_airport\", \"destination_airport\").distinct().groupBy(\"origin_airport\").count().orderBy(\"count\", ascending=False) \\\n    .join(airports, flights[\"origin_airport\"] == airports[\"iata_code\"]) \\\n    .select(\"origin_airport\", \"AIRPORT\", col(\"count\").alias(\"num_destinos\")).limit(1)\n    \nmas_destinos.coalesce(1).write.csv(\"s3a://vq-mcd2018/tarea_6/outputs/ej2g.csv\", header = True)\n  \nmas_destinos.show()","user":"anonymous","dateUpdated":"2018-03-20T07:26:08+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521528031552_-985669812","id":"20180320-064031_773595819","dateCreated":"2018-03-20T06:40:31+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:10024","dateFinished":"2018-03-20T07:26:32+0000","dateStarted":"2018-03-20T07:26:08+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------+--------------------+------------+\n|origin_airport|             AIRPORT|num_destinos|\n+--------------+--------------------+------------+\n|           ATL|Hartsfield-Jackso...|         169|\n+--------------+--------------------+------------+\n\n"}]}},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521505159682_-532486293","id":"20180320-001919_1534039475","dateCreated":"2018-03-20T00:19:19+0000","status":"READY","progressUpdateIntervalMs":500,"$$hashKey":"object:1923"}],"name":"Tarea_6","id":"2DA6Q83ER","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}